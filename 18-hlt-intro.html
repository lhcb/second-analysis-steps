<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>LHCb Starterkit: First steps in LHCb</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     ga('create', 'UA-63818884-1', 'auto');
     ga('send', 'pageview');
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="https://lhcb.github.io/first-analysis-steps/">
          <img src="img/starterkit.png" height="100" alt="LHCb Starterkit">
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">First steps in LHCb</h1>
          <h2 class="subtitle">HLT intro</h2>
<div id="learning-objectives" class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Learn a bit about the LHCb trigger</li>
<li>Learn how the results of the HLT are stored in the raw event.</li>
<li>Use an interactive python session to explore the HLT results.</li>
</ul>
</div>
</div>
<p>The LHCb trigger reduces the input rate event rate of approximately 12 MHz to 12.5 kHz of events that are written to offline tape storage. The rate reduction is achieved in three steps: L0, HLT1 and HLT2. L0 is implemented in custom FPGAs, has a fixed latency of 4 Î¼s and a maximum output rate of 1 MHz.</p>
<p>HLT1 and HLT2 are implemented as software applications that run on the online farm; HLT1 runs in real-time and writes events to the local harddrives of the farm machines, while HLT2 uses the rest of the available CPU (100% when there is no beam) to process the events written by HLT1. Events accepted by HLT2 are sent to offline storage.</p>
<p>In Run I, both the reconstructions and selections used by HLT1, HLT2 and offline were very different. In Run II the reconstructions used in HLT2 and offline will be identical, while selections might still be different. HLT1 uses a special, fast, reconstruction that only searches for tracks with PT &gt; 500 MeV, for example.</p>
<p>Once HLT1 or HLT2 has accepted an event, the candidates accepted by all trigger lines are saved to the raw event in a stripped-down form. One of the things that is saved are all the LHCbIDs of the final state particles of a decay tree. LHCbIDs are unique identifiers for detector hits.</p>
<p>We will now have a look at the LHCbIDs of some of the stored candidates. We will use the script we <a href="http://lhcb.github.io/first-analysis-steps/05-interactive-dst.html">created earlier</a> as a starting point, and the file you <a href="http://lhcb.github.io/first-analysis-steps/05-files-from-grid.html">downloaded before</a>. Fire up your favourite editor, open the script and save a copy to work on as <code>tistos.py</code>. There are a few things in the script that we don't need and can be removed, such as the print_decay and decay finder tools.</p>
<p>Like the stripping, the decisions of the HLT are saved in so-called DecReports. You can find them in <code>Hlt/DecReports</code> and <code>Hlt2/DecReports</code>, have a look at what they contain.</p>
<pre class="sourceCode python"><code class="sourceCode python">evt[<span class="st">&#39;Hlt1/DecReports&#39;</span>]
evt[<span class="st">&#39;Hlt2/DecReports&#39;</span>]</code></pre>
<p>An important difference with the stripping is that for the HLT, all the decisions are present, even if they are false. Copy the <code>advance</code> function to <code>advance_hlt</code>, make it work on HLT decisions and make sure it really checks the decision. This can be done using the <code>decision</code> member function of a <code>DecReport</code>. Note that all names in the reports end with <code>Decision</code>.</p>
<pre class="sourceCode python"><code class="sourceCode python">reports = evt[<span class="st">&#39;Hlt1/DecReports&#39;</span>]
report = reports.decReport(<span class="st">&#39;Hlt1TrackAllL0Decision&#39;</span>)
<span class="dt">print</span> report.decision()</code></pre>
<p>The HLT1 selection that was most efficient for hadronic charm and beauty decays in Run-I was called Hlt1TrackAllL0. Use the advance function to find an event that was accepted by that trigger selection.</p>
<p>The DecReports only contain the decisions, the candidates are stored in the SelReports (&quot;Hlt{1,2}/SelReports&quot;). Get the Hlt1 SelReports from the event store and retrieve the one for Hlt1TrackAllL0 using the selReport function, analogously to how the DecReport was retrieved above.</p>
<p>The SelReports store candidates in a tree of sub-structures, which can be accessed using the substructure member funtion of a report. Any SelReport has at least one level of sub-structure. The sub-structure is internally stored in SmartRefs, which can be derefereced using their &quot;data&quot; method. Let's have a look at a SelReport for Hlt1TrackAllL0.</p>
<pre class="sourceCode python"><code class="sourceCode python">reports = evt[<span class="st">&#39;Hlt1/SelReports&#39;</span>]
report = reports.selReport(<span class="st">&#39;Hlt1TrackAllL0Decision&#39;</span>)
<span class="dt">print</span> report
report.substructure().size()
report.substructure().substructure()[<span class="dv">0</span>]
report.substructure().substructure()[<span class="dv">0</span>].data()</code></pre>
<p>In addition to the LHCbIDs, some numbers are also stored, such as the momentum of the track. These are stored in the numerical info dictionary that can be retrieved using:</p>
<pre class="sourceCode python"><code class="sourceCode python">report.substructure().substructure()[<span class="dv">0</span>].numericalInfo()</code></pre>
<div id="plot-the-transverse-momentum-distribution" class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Plot the transverse momentum distribution</h2>
</div>
<div class="panel-body">
<p>Make a plot of the total and transverse moment distributions of all candidates accepted by the Hlt1TrackAllL0 selection.</p>
</div>
</div>
<p>The LHCbIDs of the (in this case) track can be retrieved using:</p>
<pre class="sourceCode python"><code class="sourceCode python">report.substructure().substructure()[<span class="dv">0</span>].lhcbIDs()</code></pre>
<div id="subdetector-lhcb-ids." class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Subdetector LHCb IDs.</h2>
</div>
<div class="panel-body">
<p>The LHCbIDs can tell you which sub-detector they belong too. Have a look at the doxygen to see what methods you can use (hint: find &quot;LHCbID (LHCb) in the <a href="http://lhcb-release-area.web.cern.ch/LHCb-release-area/DOC/davinci/latest_doxygen/classes.html">class index</a>). And get an idea of how many sub-detector hits are on the tracks. Does this match what you would expect?</p>
</div>
</div>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/lhcb/first-analysis-steps">Source</a>
        <a class="label swc-blue-bg" href="mailto:lhcb-starterkit@cern.ch">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
